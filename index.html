<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Premium í†µí•© ì‹œì„¸í‘œ ì—ë””í„°</title>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <style>
    :root{
      --primary:#4f46e5;
      --bg:#f1f5f9;
      --card:#ffffff;
      --danger:#ef4444;
      --muted:#64748b;
      --line:#e2e8f0;
    }
    *{ box-sizing:border-box; }
    body{
      font-family:'Pretendard', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      display:flex;
      justify-content:center;
      padding:20px;
      gap:20px;
      margin:0;
    }

    /* ì—ë””í„° ë ˆì´ì•„ì›ƒ */
    .editor-container{
      width:560px;
      background: var(--card);
      padding:25px;
      border-radius:12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      border:1px solid var(--line);
    }
    .category-box{
      border:1px solid var(--line);
      padding:15px;
      border-radius:10px;
      margin-bottom:16px;
      background:#fafafa;
    }
    .category-title{
      font-weight:800;
      margin-bottom:12px;
      color: var(--primary);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }

    /* ì…ë ¥ì°½ ê·¸ë¦¬ë“œ (ì‚­ì œ ë²„íŠ¼ í¬í•¨) */
    .input-row{
      display:grid;
      gap:8px;
      margin-bottom:8px;
      align-items:center;
      background:#fff;
      padding:6px;
      border-radius:8px;
      border:1px solid #eee;
    }
    .row-mobile{ grid-template-columns: 1.5fr 1fr 1fr 60px; }
    .row-internet{ grid-template-columns: 1.5fr 1.5fr 0.7fr 60px; }

    input{
      padding:9px 10px;
      border:1px solid #cbd5e1;
      border-radius:8px;
      font-size:13px;
      width:100%;
      outline:none;
    }
    input:focus{
      border-color: rgba(79,70,229,.45);
      box-shadow: 0 0 0 3px rgba(79,70,229,.12);
    }

    /* ë¯¸ë¦¬ë³´ê¸° ë ˆì´ì•„ì›ƒ */
    .preview-container{ position: sticky; top: 20px; }
    #capture-area{
      background:#fff;
      width: 460px;
      padding: 18px;
      border: 1px solid #111;
    }
    .main-header{
      background:#111;
      color:#fff;
      text-align:center;
      padding: 12px;
      font-size: 18px;
      font-weight: 900;
      margin-bottom: 14px;
      letter-spacing: -0.2px;
    }

    .section-table{
      width:100%;
      border-collapse: collapse;
      margin-bottom: 16px;
      table-layout: fixed;
    }
    .section-table th{
      background:#f8fafc;
      border:1px solid #ccc;
      padding:8px;
      font-size:12px;
    }
    .section-table td{
      border:1px solid #ccc;
      padding:8px;
      text-align:center;
      font-size:13px;
      word-break: break-word;
    }
    .cat-header{
      background: var(--primary) !important;
      color: white !important;
      font-weight: 900;
      font-size: 14px;
    }
    .price-text{ color:#e11d48; font-weight:900; }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn{
      cursor:pointer;
      border:none;
      border-radius:10px;
      font-weight:900;
      transition: 0.15s;
      user-select:none;
    }
    .btn:hover{ opacity: 0.9; transform: translateY(-1px); }
    .btn-add{ background:#10b981; color:#fff; padding:7px 12px; font-size:12px; }
    .btn-del{ background: var(--danger); color:#fff; height: 34px; font-size: 12px; }
    .btn-save{
      background:#111;
      color:#fff;
      width:100%;
      padding:14px;
      font-size:15px;
      margin-top:10px;
      border-radius:12px;
    }
    .btn-sub{
      background:#334155;
      color:#fff;
      width:100%;
      padding:12px;
      font-size:13px;
      border-radius:12px;
    }
    .btn-row{
      display:flex;
      gap:10px;
      margin-top: 10px;
    }
    .btn-row .btn-sub{ flex:1; }

    .info-box{
      margin-bottom:18px;
      background:#eef2ff;
      padding: 14px;
      border-radius: 12px;
      border:1px solid rgba(79,70,229,.18);
      color:#111827;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .info-box .label{ font-weight:900; }
    .hint{ font-size:12px; color: var(--muted); margin-top:10px; line-height:1.35; }
    @media (max-width: 980px){
      body{ flex-direction:column; align-items:center; }
      .editor-container{ width: min(560px, 100%); }
      #capture-area{ width: min(460px, 100%); }
      .preview-container{ position: static; }
    }
  </style>
</head>

<body>

  <div class="editor-container">
    <h2 style="margin:0 0 10px;">ğŸ“ ì‹œì„¸í‘œ í†µí•© í¸ì§‘</h2>
    <div class="info-box">
      <div class="label">ğŸ“… ì—…ë°ì´íŠ¸ ë‚ ì§œ</div>
      <input type="text" id="dateInput" value="2026-01-29" />
    </div>

    <div id="editor-fields"></div>

    <div class="btn-row">
      <button class="btn btn-sub" onclick="exportJSON()">â¬‡ï¸ JSON ë‚´ë³´ë‚´ê¸°</button>
      <button class="btn btn-sub" onclick="importJSON()">â¬†ï¸ JSON ê°€ì ¸ì˜¤ê¸°</button>
    </div>

    <button class="btn btn-save" onclick="saveImage()">ğŸ“¸ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸°</button>

    <div class="hint">
      âœ… ìë™ì €ì¥: ì…ë ¥ ì¦‰ì‹œ ì €ì¥ë©ë‹ˆë‹¤(ì´ ë¸Œë¼ìš°ì €/ê¸°ê¸° ê¸°ì¤€).<br>
      âœ… ë¹ˆ ì¤„ì€ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ìë™ìœ¼ë¡œ ìˆ¨ê¹€ ì²˜ë¦¬ë©ë‹ˆë‹¤.<br>
      âœ… ê° ì¹´í…Œê³ ë¦¬ëŠ” ìµœì†Œ 1ì¤„ì€ ìœ ì§€ë©ë‹ˆë‹¤(ì‹¤ìˆ˜ ì‚­ì œ ë°©ì§€).
    </div>
  </div>

  <div class="preview-container">
    <div id="capture-area">
      <div class="main-header">ğŸ“± ì„±ì§€ í†µí•© ì‹œì„¸í‘œ (<span id="viewDate">2026-01-29</span>)</div>
      <div id="table-render-zone"></div>
      <p style="font-size:11px; color:#666; text-align:center; margin-top: 10px;">
        â€» ì‹¤ì œ ì‹œì„¸ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ ë°©ë¬¸ ì „ í™•ì¸ ë°”ëë‹ˆë‹¤.
      </p>
    </div>
  </div>

  <script>
    // ===== ë°ì´í„° êµ¬ì¡° =====
    const categories = [
      { id:'galaxy',  name:'âœ¨ GALAXY (ì‚¼ì„±)',      type:'mobile',   rows:[{v1:'', v2:'', v3:''}] },
      { id:'iphone',  name:'ğŸ IPHONE (ì• í”Œ)',      type:'mobile',   rows:[{v1:'', v2:'', v3:''}] },
      { id:'kids',    name:'ğŸ‘¶ í‚¤ì¦ˆí°/íš¨ë„í°',       type:'mobile',   rows:[{v1:'', v2:'', v3:''}] },
      { id:'internet',name:'ğŸŒ ì¸í„°ë„· + TV ê²°í•©',    type:'internet', rows:[{v1:'', v2:'', v3:''}] }
    ];

    // ===== ë¡œì»¬ ì €ì¥ =====
    const STORAGE_KEY = "premium_price_editor_v1";

    function saveState(){
      const payload = {
        date: document.getElementById('dateInput').value || "",
        categories: categories.map(c => ({ id:c.id, rows:c.rows }))
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    }

    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      try{
        const payload = JSON.parse(raw);
        if(payload?.date) document.getElementById('dateInput').value = payload.date;

        const map = new Map((payload?.categories || []).map(x => [x.id, x.rows]));
        categories.forEach(c => {
          const rows = map.get(c.id);
          if(Array.isArray(rows) && rows.length){
            c.rows = rows;
          }
        });
      }catch(e){}
    }

    // ===== UI ë Œë” =====
    function initEditor(){
      const container = document.getElementById('editor-fields');
      container.innerHTML = '';

      categories.forEach((cat, catIdx) => {
        const isInternet = cat.type === 'internet';
        const box = document.createElement('div');
        box.className = 'category-box';

        box.innerHTML = `
          <div class="category-title">
            <span>${cat.name}</span>
            <button class="btn btn-add" onclick="addRow(${catIdx})">+ ì¤„ ì¶”ê°€</button>
          </div>
          <div id="cat-rows-${catIdx}">
            ${cat.rows.map((row, rowIdx) => `
              <div class="input-row ${isInternet ? 'row-internet' : 'row-mobile'}">
                <input type="text"
                  placeholder="${isInternet ? 'ìƒí’ˆëª…(ì˜ˆ: LG+TV)' : 'ëª¨ë¸ëª…'}"
                  value="${escapeAttr(row.v1)}"
                  oninput="updateData(${catIdx}, ${rowIdx}, 'v1', this.value)">
                <input type="text"
                  placeholder="${isInternet ? 'í˜„ê¸ˆì§€ì›' : 'ë²ˆì´'}"
                  value="${escapeAttr(row.v2)}"
                  oninput="updateData(${catIdx}, ${rowIdx}, 'v2', this.value)">
                <input type="text"
                  placeholder="${isInternet ? 'ë¹„ê³ ' : 'ê¸°ë³€'}"
                  value="${escapeAttr(row.v3)}"
                  oninput="updateData(${catIdx}, ${rowIdx}, 'v3', this.value)">
                <button class="btn btn-del" onclick="delRow(${catIdx}, ${rowIdx})">ì‚­ì œ</button>
              </div>
            `).join('')}
          </div>
        `;

        container.appendChild(box);
      });

      renderTable();
    }

    function escapeAttr(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;");
    }

    function addRow(catIdx){
      categories[catIdx].rows.push({v1:'', v2:'', v3:''});
      saveState();
      initEditor();
    }

    function delRow(catIdx, rowIdx){
      if(categories[catIdx].rows.length <= 1){
        alert("ìµœì†Œ 1ì¤„ì€ ë‚¨ê²¨ì•¼ í•´ìš”.");
        return;
      }
      categories[catIdx].rows.splice(rowIdx, 1);
      saveState();
      initEditor();
    }

    function updateData(catIdx, rowIdx, field, val){
      categories[catIdx].rows[rowIdx][field] = val;
      saveState();
      renderTable();
    }

    function renderTable(){
      const dateVal = document.getElementById('dateInput').value || "";
      document.getElementById('viewDate').innerText = dateVal;

      const zone = document.getElementById('table-render-zone');
      zone.innerHTML = '';

      categories.forEach(cat => {
        const isInt = cat.type === 'internet';

        // ë¹ˆ ì¤„(v1ì´ ë¹„ì–´ìˆëŠ” ì¤„)ì€ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ìˆ¨ê¹€
        const visibleRows = cat.rows.filter(r => (r.v1 || "").trim().length > 0);
        if(visibleRows.length === 0) return;

        let html = `
          <table class="section-table">
            <thead>
              <tr><th colspan="3" class="cat-header">${cat.name}</th></tr>
              <tr>
                <th width="45%">${isInt ? 'ìƒí’ˆëª…' : 'ëª¨ë¸ëª…'}</th>
                <th width="27.5%">${isInt ? 'ì§€ì›ê¸ˆ' : 'ë²ˆí˜¸ì´ë™'}</th>
                <th width="27.5%">${isInt ? 'ë¹„ê³ ' : 'ê¸°ê¸°ë³€ê²½'}</th>
              </tr>
            </thead>
            <tbody>`;

        visibleRows.forEach(row => {
          html += `
            <tr>
              <td style="text-align:left; font-weight:700;">${escapeHTML(row.v1)}</td>
              <td class="price-text">${escapeHTML(row.v2 || '-')}</td>
              <td class="${isInt ? '' : 'price-text'}">${escapeHTML(row.v3 || '-')}</td>
            </tr>`;
        });

        html += `</tbody></table>`;
        zone.innerHTML += html;
      });
    }

    function escapeHTML(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;");
    }

    // ===== JSON ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° =====
    function exportJSON(){
      const payload = {
        date: document.getElementById('dateInput').value || "",
        categories: categories.map(c => ({ id:c.id, rows:c.rows }))
      };
      const text = JSON.stringify(payload, null, 2);

      if(navigator.clipboard?.writeText){
        navigator.clipboard.writeText(text).then(
          ()=>alert("í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆì–´ìš”!"),
          ()=>prompt("ë³µì‚¬ê°€ ì•ˆ ë˜ë©´ ì—¬ê¸°ì„œ ë³µì‚¬:", text)
        );
      } else {
        prompt("ì—¬ê¸°ì„œ ë³µì‚¬:", text);
      }
    }

    function importJSON(){
      const raw = prompt("ë¶™ì—¬ë„£ì„ JSONì„ ì…ë ¥í•˜ì„¸ìš”:");
      if(!raw) return;
      try{
        const payload = JSON.parse(raw);
        if(payload?.date) document.getElementById('dateInput').value = payload.date;

        const map = new Map((payload?.categories || []).map(x => [x.id, x.rows]));
        categories.forEach(c => {
          const rows = map.get(c.id);
          if(Array.isArray(rows) && rows.length){
            c.rows = rows;
          }
        });

        saveState();
        initEditor();
        alert("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!");
      }catch(e){
        alert("JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”.");
      }
    }

    // ===== ì´ë¯¸ì§€ ì €ì¥ =====
    function saveImage(){
      const area = document.getElementById('capture-area');
      html2canvas(area, { scale: 2, backgroundColor: "#ffffff" }).then(canvas => {
        const link = document.createElement('a');
        link.download = `ì‹œì„¸í‘œ_${document.getElementById('dateInput').value || ''}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    }

    // ë‚ ì§œ ì…ë ¥ ì‹œ ì¦‰ì‹œ ë°˜ì˜ + ì €ì¥
    document.getElementById('dateInput').addEventListener('input', () => {
      saveState();
      renderTable();
    });

    // ===== ì‹œì‘ =====
    loadState();
    initEditor();
  </script>

</body>
</html>
